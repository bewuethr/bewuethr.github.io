<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-CA" xml:lang="en-CA">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2023-08-23" />
  <title>Recurse projects progress, and general update</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="/pbb.css" />
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,400i,700,700i|Source+Sans+Pro:400,400i,700,700i&display=swap" rel="stylesheet">
  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="ArtifiShell Intelligence Feed">
  <link rel="icon" href="/favicon.png" sizes="32x32" type="image/png">
  <script
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
  type="text/javascript"></script>
</head>
<body>
<div id="blogtitle"><a href="./">ArtifiShell Intelligence</a></div>
<header id="title-block-header">
<h1 class="title">Recurse projects progress, and general update</h1>
<p class="date">2023-08-23</p>
</header>
<p>Did I fall off the blogging wagon? Or was two posts per week just too
high of a cadence? Maybe there is no wagon.</p>
<h1 id="toybox">Toybox</h1>
<p>On my main project (reminder: a 3D VR physical environment that
reacts to the position of the viewing device), I’ve progressed from <a
href="2023-08-13-first-week-nyc.html">last time</a> to what I’ll keep as
the end state of the 2D version: a dot moving around on a canvas, using
the phone position to determine forces on the dot.</p>
<p>Let’s see if I can embed that entirely here…</p>
<canvas width="600" height="600">
</canvas>
<style>
  canvas {
    border: 2px solid;
    padding: 0;
    width: 100%;
  }
</style>
<script>
  class Point {
    p = {};           // position
    v = {x: 0, y: 0}; // velocity
    a = {x: 0, y: 0}; // acceleration
    m = 0.01;         // mass

    constructor(x, y) {
      this.p = {x, y};
    }

    update(F, dt) {
      const scaleBy = 120; // compensate for 1 pixel = 1 metre
      let pNew = {
        x: this.p.x + this.v.x * dt + this.a.x * dt**2 * 0.5,
        y: this.p.y + this.v.y * dt + this.a.y * dt**2 * 0.5
      };
      let aNew = {
        // scale by 100
        x: scaleBy * F.x / this.m,
        y: scaleBy * F.y / this.m
      };
      let vNew = {
        x: this.v.x + (this.a.x + aNew.x) * (dt * 0.5),
        y: this.v.y + (this.a.y + aNew.y) * (dt * 0.5)
      };

      this.p = pNew;
      this.v = vNew;
      this.a = aNew;
    }

    set(x, y) {
      this.p.x = x;
      this.p.y = y;
    }
  }

  class Scene {
    point;
    orientation;

    constructor() {
      this.point = new Point(150, 250);
      this.orientation = {
        alpha: 0,
        beta: 0,
        gamma: 0,
      };
    }
  }

  function init() {
    addEventListener("deviceorientation", handleOrientation);
    let canvas = document.querySelector("canvas");

    return canvas.getContext("2d");
  }

  function handleOrientation(event) {
    scene.orientation = {
      alpha: event.alpha,
      beta: event.beta,
      gamma: event.gamma,
    };
  }

  function toRadians(degrees) {
    return (degrees / 180) * Math.PI;
  }

  function updateModel(dt) {
    const dampingFactor = 0.5;
    const gravity = 9.81;
    const width = 600, height = 600;

    // Calculate and apply force vector
    let F = {
      x: scene.point.m * gravity * Math.sin(toRadians(scene.orientation.gamma)),
      y: scene.point.m * gravity * Math.sin(toRadians(scene.orientation.beta))
    };
    scene.point.update(F, dt);

    // Handle collision with boundary
    let {x, y} = scene.point.p;
    if (x < r) {
      x = r;
      scene.point.v.x *= -dampingFactor;
    }
    if (x > width - r) {
      x = width - r;
      scene.point.v.x *= -dampingFactor;
    }
    if (y < r) {
      y = r;
      scene.point.v.y *= -dampingFactor;
    }
    if (y > height - r) {
      y = height - r;
      scene.point.v.y *= -dampingFactor;
    }

    scene.point.set(x, y);
  }

  function paintScene(dt) {
    const width = 600, height = 600;

    updateModel(dt);
    const fontSize = 25;
    ctx.clearRect(0, 0, width, height);

    const lFactor = 0.2;
    let {x, y} = scene.point.p;

    // Dot
    ctx.strokeStyle = "black";
    ctx.beginPath();
    ctx.arc(x, y, r, 0, 2 * Math.PI);
    ctx.fill();
  }

  function frame(time) {
    if (tPrev === undefined) {
      tPrev = time;
    }
    let dt = (time - tPrev) / 1000; // convert ms to s

    paintScene(dt);
    tPrev = time;
    requestAnimationFrame(frame);
  }

  let scene = new Scene();
  let ctx = init();
  let tPrev;
  const r = 10;

  requestAnimationFrame(frame);
</script>
<p>The dot should react to how you hold the phone in a physically
plausible way; it looks like this currently doesn’t work on iPhones,
though. Here’s some footage from testing it using the in-browser sensors
tool:</p>
<iframe width="100%" style="aspect-ratio: 560/315" src="https://www.youtube.com/embed/YryiuJG0yL0?si=twAb-n4v-HB7RiRp" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen>
</iframe>
<p>I encountered lots of interesting challenges along the way!</p>
<p>Initially, I tried using the <a
href="https://developer.mozilla.org/en-US/docs/Web/API/AbsoluteOrientationSensor"><code>AbsolutOrientationSensor</code></a>
interface of the <a
href="https://developer.mozilla.org/en-US/docs/Web/API/Sensor_APIs">Sensor
APIs</a>. This requires collecting permissions for all the underlying
sensors, and returns a quaternion, a four-element vector that’s well
suited for spatial computations, but also kind of annoying when you’re
not working with a library that already uses them. (I’m not.)
Eventually, I switched to the <a
href="https://developer.mozilla.org/en-US/docs/Web/API/Window/deviceorientation_event"><code>deviceorientation</code>
event</a>, for which you don’t need to collect permissions,<a
href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a> and which gives you three simple
angles to determine device orientation.</p>
<p>There are limitations to this approach (tilting sideways by more than
90 degrees has gravity point up, for example), but it’s good enough for
now. I might have to use quaternions anyway when switching to 3D.</p>
<p>The physical model is a simple one-particle system, where the only
external force is gravity, and in every time step, acceleration,
velocity, and position are updated. Hitting a boundary mirrors one
component of the velocity vector. I had two bugs, which made me simplify
to one dimension for a while:</p>
<ul>
<li><p>The function that draws a new frame receives a timestamp, and I
compare that to the previous step’s timestamp to get the timestep size.
It’s typically around 18 ms or so, but I messed up and compared to the
time at scene creation—resulting in the timestep getting larger and
larger, and the slightest angle causing huge velocities.</p></li>
<li><p>When updating the velocity, you take the current velocity, and
modify it using the average acceleration of the current and next
timestep (<a
href="https://en.wikipedia.org/wiki/Verlet_integration">Verlet
integration</a>):</p>
<p><span class="math display">\[\mathbf{v}(t + \Delta t) = \mathbf{v}(t)
+
  \frac{\mathbf{a}(t) + \mathbf{a}(t + \Delta t)}{2} \Delta
t\]</span></p>
<p>I somehow lost that <span
class="math inline">\(\mathbf{v}(t)\)</span> on the right-hand side,
resulting in tiiiiiny velocities, like 1 pixel per 10 seconds <span
class="emoji" data-emoji="sweat_smile">😅</span></p></li>
</ul>
<p>But in the end, it’s working well enough for me to move on. I’ll
probably try and fix the “doesn’t work on iPhones” issue at some point,
but I don’t want to waste much time on it now. The current result is <a
href="/vr-toybox">here</a> (lets you select between a 1D and 2D
version).</p>
<h1 id="building-git-and-learning-ruby">Building Git and learning
Ruby</h1>
<p>My fallback project for when I’ve had enough of the toybox is to work
through the <a
href="https://shop.jcoglan.com/building-git/"><em>Building Git</em>
book</a>, which guides through implementing Git in Ruby; and I’m reading
the “Pickaxe book”, <a
href="https://pragprog.com/titles/ruby5/programming-ruby-3-2-5th-edition/"><em>Programming
Ruby</em></a>, as a complement.</p>
<p>I’ve made steady progress with both, and really enjoy Ruby so far.
Much of it reminds me of Perl, but without the sigils (e.g., the
<code>$</code> in <code>my $str = "abc"</code>), but first-class
object-orientation,<a href="#fn2" class="footnote-ref" id="fnref2"
role="doc-noteref"><sup>2</sup></a> and a slightly less dramatic
community, as far as I can tell.</p>
<p>We’ve started a recurring <em>Building Git</em> meeting with a
handful of people attending, though not everybody uses Ruby, but I’m
glad I’ll have others to discuss progress and insights. So far, my Git
implementation can create a commit to contain itself, but no branches,
or history. The idea is that you never use Git for version control, but
the tool itself while developing it. It was fun to see my prompt
recognize that there seems to be a Git repository when the commit was
successfully created for the first time!</p>
<p>There’s no way we’ll finish before my half-batch ends, but I hope
I’ll be able to keep attending the meeting.</p>
<h1 id="coding-challenges">Coding challenges</h1>
<p>Most days, I solve two small Ruby problems, and one or two in jq,
both on the <a href="https://exercism.org/">Exercism</a> platform. It’s
a great way to get some programming in early in the day without having
to think much about what exactly to work on. Ruby is an obvious choice
to complement the reading above, and jq is fun because it’s
stream-oriented and requires very different thinking from how I usually
approach problems.</p>
<h1 id="other-recurse-things">Other Recurse things</h1>
<p>I’ve settled into a rhythm of doing an in-person (video) checkin in
the mornings, and a short end-of-day written checkin.</p>
<p>There are lots of book clubs that I’d love to attend, but I don’t
want to stretch myself too thin; however, the list has substantial
overlap with my own “to read” list, so I hope to get around to these at
some point:</p>
<ul>
<li><a href="https://www.nand2tetris.org/"><em>Nand to
Tetris</em></a></li>
<li><a href="https://craftinginterpreters.com/"><em>Crafting
Interpreters</em></a></li>
<li><a href="https://csapp.cs.cmu.edu/"><em>Computer Systems: A
Programmer’s Perspective</em></a></li>
</ul>
<p>plus (but not on my list) <a
href="https://understandingdistributed.systems/"><em>Understanding
Distributed Systems</em></a>, <a
href="https://rust-unofficial.github.io/too-many-lists/"><em>Learning
Rust With Entirely Too Many Linked Lists</em></a>, <a
href="https://www.pearson.com/en-us/subject-catalog/p/modern-operating-systems/P200000003295/9780137618880"><em>Modern
Operating Systems</em></a>…</p>
<p>On Friday, a small group visited the New York Transit Museum, which
turned out to be super interesting. I think the most mind-blowing fact I
learned about was that to keep the water out, the tunnels were
pressurized up to 7 bar or so, so the workers suffered from all the
problems you can have when you surface too fast when scuba diving
(getting the “bends”). Not to mention what happened when there was a
leak, and the workers were literally sucked out of the tunnel!</p>
<p>Tomorrow, we have “Impossible Stuff Day”, which is a bit like a
one-day hackathon where you work on something that’s supposed to feel
impossibly challenging, and definitely beyond the edge of your
abilities. I’m not sure if I’ll come up with a suitable project idea,
but I do have the offer to join a group that plans to settle the P
vs. NP problem <span class="emoji" data-emoji="wink">😉</span></p>
<p>All in all, I’m happy with how things are going, and very much enjoy
going to the hub every day and meet all the other Recursers. There are a
few social activities later this week that I’m planning to attend; until
now, there has been a lot of screen time for me mostly!</p>
<h1 id="non-recurse-things">Non-Recurse things</h1>
<p>On Sunday, I have moved into my new AirBnB in Prospect Heights, and
it’s a huge upgrade, both in terms of the unit, and the neighbourhood.
I’m now just a few minutes away from Prospect Park, and plan to take
advantage of that for my runs. (Which, sad face, seem to only happen on
weekends.)</p>
<p>I’m eating not too terribly, but also not very varied; I think I know
all Trader Joe’s salads now. The new place has a nice, fully stocked
kitchen, so who knows, maybe I’ll cook sometimes.</p>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>But you <em>do</em> need to be in a “secure context”, so
I had to figure out how to serve pages locally using HTTPS. I ended up
using <a href="https://github.com/FiloSottile/mkcert">mkcert</a> and a
little Python script for the HTTPS server.<a href="#fnref1"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Perl <em>just</em> got <a
href="https://perldoc.perl.org/perl5380delta#New-class-Feature">experimental
support for classes</a>.<a href="#fnref2" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<script data-goatcounter="https://artifishellintelligence.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</body>
</html>
