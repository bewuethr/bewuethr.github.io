<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-CA" xml:lang="en-CA">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2023-08-29" />
  <title>Mounting an image as a filesystem</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #073642;
        color: #839496;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #839496;  padding-left: 4px; }
    div.sourceCode
      { color: #839496; background-color: #002b36; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #d33682; font-weight: bold; } /* Alert */
    code span.an { color: #dc322f; } /* Annotation */
    code span.at { color: #b58900; } /* Attribute */
    code span.bn { color: #2aa198; } /* BaseN */
    code span.bu { color: #859900; } /* BuiltIn */
    code span.cf { color: #859900; } /* ControlFlow */
    code span.ch { color: #dc322f; } /* Char */
    code span.cn { color: #2aa198; } /* Constant */
    code span.co { color: #586e75; font-style: italic; } /* Comment */
    code span.cv { color: #268bd2; } /* CommentVar */
    code span.do { color: #2aa198; } /* Documentation */
    code span.dt { color: #cb4b16; } /* DataType */
    code span.dv { color: #2aa198; } /* DecVal */
    code span.er { color: #ffffff; background-color: #ff0000; } /* Error */
    code span.ex { color: #839496; } /* Extension */
    code span.fl { color: #2aa198; } /* Float */
    code span.fu { color: #268bd2; } /* Function */
    code span.im { color: #2aa198; } /* Import */
    code span.in { color: #2aa198; } /* Information */
    code span.kw { color: #859900; } /* Keyword */
    code span.op { color: #859900; } /* Operator */
    code span.ot { color: #859900; } /* Other */
    code span.pp { color: #cb4b16; } /* Preprocessor */
    code span.re { color: #cb4b16; } /* RegionMarker */
    code span.sc { color: #dc322f; } /* SpecialChar */
    code span.ss { color: #268bd2; } /* SpecialString */
    code span.st { color: #2aa198; } /* String */
    code span.va { color: #cb4b16; } /* Variable */
    code span.vs { color: #2aa198; } /* VerbatimString */
    code span.wa { color: #dc322f; font-weight: bold; } /* Warning */
  </style>
  <link rel="stylesheet" href="/pbb.css" />
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,400i,700,700i|Source+Sans+Pro:400,400i,700,700i&display=swap" rel="stylesheet">
  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="ArtifiShell Intelligence Feed">
  <link rel="icon" href="/favicon.png" sizes="32x32" type="image/png">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="blogtitle"><a href="./">ArtifiShell Intelligence</a></div>
<header id="title-block-header">
<h1 class="title">Mounting an image as a filesystem</h1>
<p class="date">2023-08-29</p>
</header>
<nav id="TOC" role="doc-toc">
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#research" id="toc-research">Research</a></li>
<li><a href="#fuse-implementations" id="toc-fuse-implementations">FUSE
implementations</a></li>
<li><a href="#implementation-and-obstacles"
id="toc-implementation-and-obstacles">Implementation and
obstacles</a></li>
<li><a href="#usage-example" id="toc-usage-example">Usage
example</a></li>
<li><a href="#learnings-and-further-work"
id="toc-learnings-and-further-work">Learnings and further work</a></li>
</ul>
</nav>
<p>Last week, we had â€œImpossible Stuff Dayâ€ at the Recurse Center. Itâ€™s
a bit like a one-day hackathon, with the main goal of trying to do
something thatâ€™s definitely past the <a
href="https://www.recurse.com/self-directives#work-at-the-edge">edge of
oneâ€™s abilities</a>, and maybe adjust that edge afterwards.</p>
<p>I set out to access an image as a filesystem. Iâ€™d seen similar
projects:</p>
<ul>
<li><a href="https://omar.website/tabfs/">TabFS</a> (mount browser tabs
as a filesystem)</li>
<li><a href="https://github.com/dertuxmalwieder/rssfs">rssfs</a> (RSS
reader as a filesystem)</li>
<li><a href="https://mgree.github.io/ffs/">ffs</a>, the â€œfile
filesystemâ€ (mount semi-structured data as a filesystem)</li>
</ul>
<p>So it was obviously possible. The impossible (to me) aspect was a
combination of having a very fuzzy (at best) idea of where this would be
implemented (something something system calls), and having properly
worked with C more than ten years ago.</p>
<h1 id="research">Research</h1>
<p>I hit the Recurse Center library so I could leaf through thick books
instead of turning my mouse wheel. After some quality time with <a
href="https://man7.org/tlpi/">a</a> <a
href="https://www.oreilly.com/library/view/advanced-programming-in/9780321638014/">few</a>
<a
href="https://www.pearson.com/en-us/subject-catalog/p/unix-programming-environment-the/P200000000349/9780139376818">classics</a>,
I had a very rough idea: there is an abstraction for common filesystem
operations, the <em>virtual file system</em><a href="#fn1"
class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>
(VFS), and a filesystem has to implement that interface. <em>The Linux
Programming Interface</em> had a helpful diagram, roughly like this:</p>
<!--
graph {
  node [shape=box]
  vfs [label="Virtual File System (VFS)"]
  Application -- vfs
  vfs -- {ext2, ext3, Reiserfs, VFAT, NFS}
}
-->
<img src="diagrams/a84f5c0.svg" />
<p>However, specifics about <em>what</em> exactly makes up the VFS were
a bit more difficult to come by. The Wikipedia page about VFS and a hint
from a <a href="https://leoshimo.com/">fellow Recurser</a> eventually
led me to <a
href="https://en.wikipedia.org/wiki/Filesystem_in_Userspace">FUSE</a>,
â€œFilesystem in Userspaceâ€.</p>
<blockquote>
<p><strong>Filesystem in Userspace</strong> (<strong>FUSE</strong>) is a
software interface [â€¦] that lets non-privileged users create their own
file systems without editing kernel code.</p>
</blockquote>
<p>Phew <span class="emoji" data-emoji="sweat_smile">ğŸ˜…</span> No kernel
hacking for me!<a href="#fn2" class="footnote-ref" id="fnref2"
role="doc-noteref"><sup>2</sup></a></p>
<h1 id="fuse-implementations">FUSE implementations</h1>
<p>To just see it in action, jump ahead to <em><a
href="#usage-example">Usage Example</a></em>.</p>
<p>There is a <a href="https://github.com/libfuse/libfuse">reference
implementation</a> of FUSE, in the form of a chunky C library.
Apparently, thereâ€™s sometimes a bit of confusion around FUSE the
interface and libfuse the implementation, with people referring to both
as just â€œFUSEâ€â€”but the important part is that maybe thereâ€™s another
implementation that is more Benjamin-friendly!</p>
<p>At first, I found <a href="https://github.com/hanwen/go-fuse">Go
bindings for libfuse</a>, which already looked better to my <a
href="https://go.dev/blog/gopher">Gopher</a> eyes. And a little later, a
from-scratch implementation in pure Go: <a
href="https://github.com/bazil/fuse">bazil.org/fuse</a>, via <a
href="https://blog.gopheracademy.com/advent-2014/fuse-zipfs/">this blog
post</a> describing <a
href="https://github.com/bazil/zipfs"><code>zipfs</code></a>, which
mounts a ZIP archive as a filesystem. I started digging into the
code.</p>
<p>And this is how far I got on the day itself, so it really was
impossible for me! A few people demoed their most excellent projects: a
web server in Zig as a first Zig project; beginnings of a collaborative
editor with video chat; a <a
href="https://eieio.games/nonsense/hexagone-converting-hex-to-rgb-with-a-font/">font
that converts hex colours to RGB</a>; building a neural network; coming
up with an image format from scratch; teaching the <a
href="https://flipperzero.one/">Flipper Zero</a> to understand more
types of NFC tagsâ€¦</p>
<h1 id="implementation-and-obstacles">Implementation and obstacles</h1>
<p>I started modifying <code>zipfs</code>. My goal was to mount an image
and expose it as a directory tree, with the top-level directories
representing rows of pixels, containing directories representing
individual pixels, and in those directories, there should be files named
<code>r</code>, <code>g</code>, and <code>b</code>, containing RGB
values scaled to 0â€“255. Something like this, for a 2-by-2 pixel
image:</p>
<pre class="none"><code>.
â”œâ”€â”€ row0
â”‚Â Â  â”œâ”€â”€ col0
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ b
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ g
â”‚Â Â  â”‚Â Â  â””â”€â”€ r
â”‚Â Â  â””â”€â”€ col1
â”‚Â Â   Â Â  â”œâ”€â”€ b
â”‚Â Â   Â Â  â”œâ”€â”€ g
â”‚Â Â   Â Â  â””â”€â”€ r
â””â”€â”€ row1
 Â Â  â”œâ”€â”€ col0
 Â Â  â”‚Â Â  â”œâ”€â”€ b
 Â Â  â”‚Â Â  â”œâ”€â”€ g
 Â Â  â”‚Â Â  â””â”€â”€ r
 Â Â  â””â”€â”€ col1
 Â Â   Â Â  â”œâ”€â”€ b
 Â Â   Â Â  â”œâ”€â”€ g
 Â Â   Â Â  â””â”€â”€ r</code></pre>
<p>bazil.org/fuse provides a very nice higher-level abstraction for a
filesystem, where you have to implement a few required interfaces, and
then add more capabilities via implementing more interfaces. The minimal
set looks something like</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> FS <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    Root<span class="op">()</span> <span class="op">(</span>Node<span class="op">,</span> <span class="dt">error</span><span class="op">)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Node <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    Attr<span class="op">(</span>ctx context<span class="op">.</span>Context<span class="op">,</span> attr <span class="op">*</span>fuse<span class="op">.</span>Attr<span class="op">)</span> <span class="dt">error</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Directories and files both implement <code>Node</code>. To enable a
directory to respond to lookup requests, it also has to implement
<code>NodeRequestLookuper</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> NodeRequestLookuper <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    Lookup<span class="op">(</span>ctx context<span class="op">.</span>Context<span class="op">,</span> req <span class="op">*</span>fuse<span class="op">.</span>LookupRequest<span class="op">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        resp <span class="op">*</span>fuse<span class="op">.</span>LookupResponse<span class="op">)</span> <span class="op">(</span>Node<span class="op">,</span> <span class="dt">error</span><span class="op">)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This is where we can â€œmake upâ€ whatever directory structure we want.
We also want directories to be able to handle requests corresponding to
the <code>readdir</code> system call, and return a slice of directory
entries; this is done by implementing
<code>HandleReadDirAller</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> HandleReadDirAller <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    ReadDirAll<span class="op">(</span>ctx context<span class="op">.</span>Context<span class="op">)</span> <span class="op">([]</span>fuse<span class="op">.</span>Dirent<span class="op">,</span> <span class="dt">error</span><span class="op">)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Notice the super-strict adherence to the single-method interface Go
naming convention of just appending <code>-er</code>!</p>
<p>Lastly, so we can open files, they have to implement
<code>NodeOpener</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> NodeOpener <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    Open<span class="op">(</span>ctx context<span class="op">.</span>Context<span class="op">,</span> req <span class="op">*</span>fuse<span class="op">.</span>OpenRequest<span class="op">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        resp <span class="op">*</span>fuse<span class="op">.</span>OpenResponse<span class="op">)</span> <span class="op">(</span>Handle<span class="op">,</span> <span class="dt">error</span><span class="op">)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>and the returned handle has to implement <code>HandleReader</code> to
actually retrieve file contents:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> HandleReader <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    Read<span class="op">(</span>ctx context<span class="op">.</span>Context<span class="op">,</span> req <span class="op">*</span>fuse<span class="op">.</span>ReadRequest<span class="op">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        resp <span class="op">*</span>fuse<span class="op">.</span>ReadResponse<span class="op">)</span> <span class="dt">error</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>All these combined are enough for a read-only filesystem.</p>
<p>The implementation reads the image into memory when mounting (error
checks and deferred close calls omitted):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> mount<span class="op">(</span>path<span class="op">,</span> mountpoint <span class="dt">string</span><span class="op">)</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    reader<span class="op">,</span> _ <span class="op">:=</span> os<span class="op">.</span>Open<span class="op">(</span>path<span class="op">)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    img<span class="op">,</span> _<span class="op">,</span> _ <span class="op">:=</span> image<span class="op">.</span>Decode<span class="op">(</span>reader<span class="op">)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    c<span class="op">,</span> _ <span class="op">:=</span> fuse<span class="op">.</span>Mount<span class="op">(</span>mountpoint<span class="op">)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    filesys <span class="op">:=</span> <span class="op">&amp;</span>FS<span class="op">{</span>img<span class="op">:</span> img<span class="op">}</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fs<span class="op">.</span>Serve<span class="op">(</span>c<span class="op">,</span> filesys<span class="op">)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And from then on, we can look things up in the image abstraction. For
example, a <code>File</code> has a reference to the image, knows about
its own name, and its pixel coordinates:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> File <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    img  image<span class="op">.</span>Image</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    name <span class="dt">string</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">,</span> y <span class="dt">int</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And when we <code>Open</code> a file, we access the colour value at
those coordinates, and return a handle with a readcloser on a string
containing that value:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>f <span class="op">*</span>File<span class="op">)</span> Open<span class="op">(</span>ctx context<span class="op">.</span>Context<span class="op">,</span> req <span class="op">*</span>fuse<span class="op">.</span>OpenRequest<span class="op">,</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    resp <span class="op">*</span>fuse<span class="op">.</span>OpenResponse<span class="op">)</span> <span class="op">(</span>fs<span class="op">.</span>Handle<span class="op">,</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    r<span class="op">,</span> g<span class="op">,</span> b<span class="op">,</span> _ <span class="op">:=</span> f<span class="op">.</span>img<span class="op">.</span>At<span class="op">(</span>f<span class="op">.</span>x<span class="op">,</span> f<span class="op">.</span>y<span class="op">).</span>RGBA<span class="op">()</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> val <span class="dt">uint32</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> f<span class="op">.</span>name <span class="op">{</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&quot;r&quot;</span><span class="op">:</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      val <span class="op">=</span> r</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&quot;g&quot;</span><span class="op">:</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      val <span class="op">=</span> g</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&quot;b&quot;</span><span class="op">:</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      val <span class="op">=</span> b</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="ot">nil</span><span class="op">,</span> fmt<span class="op">.</span>Errorf<span class="op">(</span><span class="st">&quot;invalid filename %q&quot;</span><span class="op">,</span> f<span class="op">.</span>name<span class="op">)</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert from 0..65535 to 0..255</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    colStr <span class="op">:=</span> strconv<span class="op">.</span>FormatUint<span class="op">(</span><span class="dt">uint64</span><span class="op">(</span>val<span class="op">&gt;&gt;</span><span class="dv">8</span><span class="op">),</span> <span class="dv">10</span><span class="op">)</span> <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">&amp;</span>FileHandle<span class="op">{</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        r<span class="op">:</span> io<span class="op">.</span>NopCloser<span class="op">(</span>strings<span class="op">.</span>NewReader<span class="op">(</span>colStr<span class="op">)),</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span> <span class="ot">nil</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>It wasnâ€™t smooth sailing, though. For the longest time, all my
filesystem did was telling me <code>Input/output error</code> when
trying to perform any operation on it whatsoever. After a long, long,
time I realized that my directory implementation has to set the
directory mode bit:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>d <span class="op">*</span>Dir<span class="op">)</span> Attr<span class="op">(</span>ctx context<span class="op">.</span>Context<span class="op">,</span> a <span class="op">*</span>fuse<span class="op">.</span>Attr<span class="op">)</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    a<span class="op">.</span>Mode <span class="op">=</span> iofs<span class="op">.</span>ModeDir <span class="op">|</span> <span class="bn">0755</span>  <span class="co">// &lt;-- This one!</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ot">nil</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This was sufficient for most things to suddenly work!</p>
<p>The only other snag was all files for some reason being empty, even
though all methods were implemented. This one was way sillier because it
has nothing to do with domain knowledge. Instead, my <code>Read</code>
method did this:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>fh <span class="op">*</span>FileHandle<span class="op">)</span> Read<span class="op">(</span>ctx context<span class="op">.</span>Context<span class="op">,</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    req <span class="op">*</span>fuse<span class="op">.</span>ReadRequest<span class="op">,</span> resp <span class="op">*</span>fuse<span class="op">.</span>ReadResponse<span class="op">)</span> <span class="dt">error</span> <span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> val <span class="op">[]</span><span class="dt">byte</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    _<span class="op">,</span> err <span class="op">:=</span> fh<span class="op">.</span>r<span class="op">.</span>Read<span class="op">(</span>val<span class="op">)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    resp<span class="op">.</span>Data <span class="op">=</span> val</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> err</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>As it turns out, the <code>io.Reader</code> interface</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Reader <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    Read<span class="op">(</span>p <span class="op">[]</span><span class="dt">byte</span><span class="op">)</span> <span class="op">(</span>n <span class="dt">int</span><span class="op">,</span> err <span class="dt">error</span><span class="op">)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>isnâ€™t magically adjusting the byte slice size for you (or allocating
it), so if you give it a nil slice, you get a nil slice back. The fix
was as simple as</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode diff"><code class="sourceCode diff"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>  func (fh *FileHandle) Read(ctx context.Context,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>      req *fuse.ReadRequest, resp *fuse.ReadResponse) error {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="st">-     var val []byte</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="va">+     val := make([]byte, req.Size)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>      _, err := fh.r.Read(val)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>      resp.Data = val</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>      return err</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p>The end results of all this is at <a
href="https://github.com/bewuethr/imgfs">bewuethr/imgfs</a>.</p>
<h1 id="usage-example">Usage example</h1>
<p>Letâ€™s mount this <a
href="https://emoji.supply/kitchen/?%F0%9F%AA%84+%F0%9F%90%99=8wxe01">blobtopus</a>
as a filesystem:</p>
<figure>
<img src="images/2023-08-29-blobtopus.webp" alt="Blobtopus" />
<figcaption aria-hidden="true">Blobtopus</figcaption>
</figure>
<p>Or rather, this 10x10-pixel version of it:</p>
<figure>
<img src="images/2023-08-29-blobtopus-10x10.webp"
alt="Blobtopus pixels with coordinates and RGB values" />
<figcaption aria-hidden="true">Blobtopus pixels with coordinates and RGB
values</figcaption>
</figure>
<p>Coordinates for <em>x</em> increase from left to right, and for
<em>y</em> from top to bottom. Three pixels have their RGB values
labelled, as retrieved with a colour picker.</p>
<p>We create a mount directory, and then mount the image into it:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> mnt</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">imgfs</span> blobtopus.png mnt</span></code></pre></div>
<p>imgfs supports PNG, JPEG, GIF, and WebP.<a href="#fn3"
class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>
<code>mnt</code> now contains one directory per pixel row:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tree <span class="at">-L</span> 1 mnt</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mnt</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> row00</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> row01</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> row02</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> row03</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> row04</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> row05</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> row06</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> row07</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> row08</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="ex">â””â”€â”€</span> row09</span></code></pre></div>
<p>And each of these contains ten pixel directories (â€œcolâ€ for
â€œcolumnâ€):</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tree <span class="at">-L</span> 1 mnt/row00</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mnt/row00</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> col00</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> col01</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> col02</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> col03</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> col04</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> col05</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> col06</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> col07</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> col08</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="ex">â””â”€â”€</span> col09</span></code></pre></div>
<p>And in each of those, there is one file per RGB component:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tree mnt/row00/col00</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mnt/row00/col00</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> b</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> g</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ex">â””â”€â”€</span> r</span></code></pre></div>
<p>Now, letâ€™s check the labelled pixels! The pixel at
<em>x</em>/<em>y</em> coordinate (02/01) is in
<code>row01/col02</code>.</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> head mnt/row01/col02/<span class="dt">{r</span><span class="op">,</span><span class="dt">g</span><span class="op">,</span><span class="dt">b}</span>  <span class="co"># Want: (250,231,170)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">==</span><span class="op">&gt;</span> mnt/row01/col02/r <span class="op">&lt;</span>==</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">250</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> mnt/row01/col02/g <span class="op">&lt;</span>==</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="ex">231</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> mnt/row01/col02/b <span class="op">&lt;</span>==</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="ex">170</span></span></code></pre></div>
<p>Looking good!</p>
<p>And the other two:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> head mnt/row03/col06/<span class="dt">{r</span><span class="op">,</span><span class="dt">g</span><span class="op">,</span><span class="dt">b}</span>  <span class="co"># Want: (164,93,0)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> mnt/row03/col06/r <span class="op">&lt;</span>==</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">164</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> mnt/row03/col06/g <span class="op">&lt;</span>==</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ex">93</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> mnt/row03/col06/b <span class="op">&lt;</span>==</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> head mnt/row07/col05/<span class="dt">{r</span><span class="op">,</span><span class="dt">g</span><span class="op">,</span><span class="dt">b}</span>  <span class="co"># Want: (255,162,61)</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> mnt/row07/col05/r <span class="op">&lt;</span>==</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="ex">255</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> mnt/row07/col05/g <span class="op">&lt;</span>==</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="ex">162</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> mnt/row07/col05/b <span class="op">&lt;</span>==</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="ex">61</span></span></code></pre></div>
<p>Ta-daah <span class="emoji" data-emoji="partying_face">ğŸ¥³</span></p>
<h1 id="learnings-and-further-work">Learnings and further work</h1>
<p>The one cool additional thing to do would be to make the filesystem
writeable: updating the colour value in a file would change the pixel on
the actual image. Updating the in-memory image representation would be
straightforward, but continually changing an on-disk image file probably
less so; in-place changes wouldnâ€™t work, so weâ€™d have to create new
images files and rename them.</p>
<p>I certainly learned quite a few things about filesystems and FUSE,
but also feel like I scratched just the surface. The full FUSE API is
huge, and Iâ€™ve implemented a fraction of it, using a very high-level
abstraction, at that.</p>
<p>A meta-insight was that designating a chunk of time to doing
something specific makes it easy to get started (you start when
everybody else starts), and the whole thing being timeboxed resulted in
intense focus on the problem, even when not every second was exactly
thrilling.</p>
<p>This was very noticeable when I decided to keep working on this a day
later: I made very little progress, found it difficult to focus, and got
quite frustrated. I didnâ€™t touch the project for the whole weekend, even
though I totally thought I wouldâ€”and when I got back to it on Monday,
things seemed to fall into place quite easily.</p>
<p>In any case, Iâ€™m pretty happy I de-mystified â€œX as a filesystemâ€ a
bit for myself, and maybe now also for others.</p>
<aside id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>Also, is it â€œfilesystemâ€ or â€œfile systemâ€? Authors donâ€™t
agree with each other, and Iâ€™ve changed it about three times already.<a
href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn2"><p>See? â€œFilesystemâ€ and â€œfile systemâ€, <em>in the same
sentence</em> <span class="emoji" data-emoji="unamused">ğŸ˜’</span><a
href="#fnref2" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn3"><p>I actually cheated a little here: I was using WebP for
the example at first, but since Iâ€™m ignoring transparency and the Go
<code>image</code> package defaults to pre-multiplying RGB values with
transparency, things were off; I had to remove all transparency first.<a
href="#fnref3" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
</ol>
</aside>
<script data-goatcounter="https://artifishellintelligence.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</body>
</html>
